# Maintainer: Blake Imsland <blake at retroco dot de>

pkgname=redis-unstable
_pkgname=redis
pkgver=2.0.0rc4
_pkgver=2.0.0-rc4
pkgrel=1
pkgdesc='advanced key-value store'
arch=('i686' 'x86_64')
url='http://code.google.com/p/redis'
license=('BSD')
depends=('bash')
makedepends=('gcc>=3.1' 'make' 'pkgconfig')
conflicts=('redis' 'redis-git')
provides=('redis')
source=("http://redis.googlecode.com/files/$_pkgname-$_pkgver.tar.gz"
         'redis.rc-d')
md5sums=('700b6475c168e9116fd80a5c8643db47'
         '7de0d0e70cef571a2da9a431e4b40917')

build() {
	cd $srcdir/$_pkgname-$_pkgver
	CFLAGS="$CFLAGS -std=c99" make || return 1

	sed -i \
		-e 's|daemonize no|daemonize yes|' \
		-e 's|dir \./|dir /var/lib/redis/|' \
		-e 's|logfile stdout|logfile /var/log/redis.log|' \
		redis.conf

	for bin in benchmark check-aof check-dump cli server; do
		install -D -m755 redis-$bin $pkgdir/usr/bin/redis-$bin || return 1
	done

	install -D -m644 COPYING $pkgdir/usr/share/licenses/redis/COPYING || return 1

	install -D -m644 redis.conf         $pkgdir/etc/redis.conf || return 1
	install -D -m755 $srcdir/redis.rc-d $pkgdir/etc/rc.d/redis || return 1
}
